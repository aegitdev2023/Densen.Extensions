@page "/pdfReaders"
@attribute [TabItemOption(Text = "PDF阅读器")]
@using MiniExcelLibs

<h4>PDF阅读器 Pdf Reader</h4>
<Tab>
    <TabItem Text="常规">
        <PdfReader PdfFile=@PdfFile
                   OnInfo="OnInfo"
                   OnError="OnError" />
        <pre>@contents</pre>
    </TabItem>
    <TabItem Text="流化">
        <h6>使用流化模式,可跨域读取文件</h6>
        <div class="row g-3">
            <div class="col-12">
                <BootstrapInputGroup>
                    <BootstrapInput @bind-Value="@UrlBaseStream" />
                    <BootstrapInput @bind-Value="@PdfFileStream" />
                    <Button Color="Color.Primary" OnClick="Apply">加载</Button>
                </BootstrapInputGroup>
            </div>
        </div>
        <PdfReader @ref="pdfReader" UrlBase="@UrlBaseStream" PdfFile="@PdfFileStream" EnableStreamingMode="true" />
    </TabItem>
    <TabItem Text="高级">
        <h6>(未完工) 强制使用 PDF.js, 需设置 PDF.js 浏览器页面路径.</h6>
        <div class="row g-3">
            <div class="col-7">
                <BootstrapInputGroup>
                    <Button Color="Color.Primary" OnClick="Apply1">视图模式</Button>
                    <Button Color="Color.Primary" OnClick="Apply2">页面模式</Button>
                    <Button Color="Color.Primary" OnClick="Apply3">页码1</Button>
                    <Button Color="Color.Primary" OnClick="Apply4">页码+</Button>
                    <BootstrapInput @bind-Value="@Search" />
                    <Button Icon="fa-solid fa-magnifying-glass" OnClick="Apply5"></Button>
                </BootstrapInputGroup>
            </div>
            <div class="col-5">
                <BootstrapInputGroup>
                    <BootstrapInput @bind-Value="@PDFJS_URL" />
                    <Checkbox @bind-Value="ForcePDFJS" DisplayText="强制PDF.js " ShowAfterLabel="true" />
                    <Button Color="Color.Primary" OnClick="Apply5">刷新</Button>
                </BootstrapInputGroup>
            </div>
        </div>
        <PdfReader @ref="pdfReader2"
                   PdfFile=@PdfFile
                   OnInfo="OnInfo"
                   OnError="OnError"
                   ForcePDFJS=@ForcePDFJS
                   PDFJS_URL=@PDFJS_URL
                   Page=@Page
                   View=@View
                   Pagemode=@Pagemode
                   Search=@Search />
        <pre>@contents</pre>
    </TabItem>
</Tab>


@code{
    private string contents;
    private string View { get; set; } = "FitV";
    private string Pagemode { get; set; } = "thumbs";
    private string Search { get; set; } = "Performance";
    private string PDFJS_URL { get; set; } = "https://pdfobject.com/pdfjs/web/viewer.html";
    private int Page { get; set; } = 3;
    private bool ForcePDFJS { get; set; } = true;
    PdfReader pdfReader;
    PdfReader pdfReader2;

#if DEBUG
    private string PdfFile = "https://localhost:5011/_content/DemoShared/sample.pdf";
#else
private string PdfFile = "https://blazor.app1.es/_content/DemoShared/sample.pdf";
#endif
    private string UrlBaseStream = "https://blazor.app1.es/_content/DemoShared/";
    private string PdfFileStream = "sample.pdf";

    private Task OnInfo(string contents)
    {
        this.contents = contents;
        StateHasChanged();
        return Task.CompletedTask;
    }
    private Task OnError(string contents)
    {
        this.contents = contents;
        StateHasChanged();
        return Task.CompletedTask;
    }

    private async Task Apply()
    {
        await pdfReader.Refresh();
    }
    private async Task Apply1()
    {
        View = View == "FitV" ? "" : "FitV";
        await pdfReader2.Refresh();
    }
    private async Task Apply2()
    {
        Pagemode = Pagemode == "thumbs" ? "" : "thumbs";
        await pdfReader2.Refresh();
    }
    private async Task Apply3()
    {
        Page = 1;
        await pdfReader2.Refresh();
    }
    private async Task Apply4()
    {
        Page++;
        await pdfReader2.Refresh();
    }
    private async Task Apply5()
    {
        await pdfReader2.Refresh();
    }

}
